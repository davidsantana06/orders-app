<div class="actions-container">
  <button mat-raised-button color="primary" (click)="openCreateDialog()">
    <mat-icon>add</mat-icon>
    Novo Pedido
  </button>

  <div class="export-buttons">
    <button mat-stroked-button [disabled]="true">
      <mat-icon>picture_as_pdf</mat-icon>
      Exportar PDF
    </button>
    <button mat-stroked-button [disabled]="true">
      <mat-icon>table_chart</mat-icon>
      Exportar Excel
    </button>
  </div>
</div>

@if (orders.length === 0) {
  <div class="empty-state">
    <mat-icon style="font-size: 48px; width: 48px; height: 48px; color: rgba(0, 0, 0, 0.26)"
      >inbox</mat-icon
    >
    <p style="margin-top: 16px; font-size: 1.1rem">Nenhum pedido encontrado</p>
    <p style="color: rgba(0, 0, 0, 0.6)">Crie um novo pedido ou ajuste os filtros de busca</p>
  </div>
} @else {
  <mat-accordion>
    @for (order of orders; track order.id) {
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <div class="order-header">
            <div class="order-info">
              <div class="info-item">
                <span class="info-label">Pedido</span>
                <span class="info-value">#{{ order.id }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Data</span>
                <span class="info-value">{{ order.createdAt | date: 'dd/MM/yyyy' }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Valor Total</span>
                <span class="info-value">{{ order.totalValue | currency: 'BRL' }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Status</span>
                <mat-chip-set>
                  <mat-chip [color]="getStatusColor(order.status)">
                    {{ order.status }}
                  </mat-chip>
                </mat-chip-set>
              </div>
            </div>
          </div>
        </mat-expansion-panel-header>

        <div style="padding: 16px">
          <h3 style="margin: 0 0 16px 0; color: rgba(0, 0, 0, 0.87)">Itens do Pedido</h3>

          @if (order.orderItems && order.orderItems.length > 0) {
            <div class="items-table-wrapper">
              <table class="items-table">
                <thead>
                  <tr>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Ano</th>
                    <th style="text-align: right">Quantidade</th>
                    <th style="text-align: right">Pre√ßo Unit.</th>
                    <th style="text-align: right">Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  @for (item of order.orderItems; track item.id) {
                    <tr>
                      <td>{{ item.make }}</td>
                      <td>{{ item.model }}</td>
                      <td>{{ item.year }}</td>
                      <td style="text-align: right">{{ item.quantity }}</td>
                      <td style="text-align: right">{{ item.unitPrice | currency: 'BRL' }}</td>
                      <td style="text-align: right; font-weight: 600">
                        {{ getItemSubtotal(item) | currency: 'BRL' }}
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <p style="color: rgba(0, 0, 0, 0.6); font-style: italic">Nenhum item neste pedido</p>
          }
        </div>

        <mat-divider></mat-divider>

        <div class="panel-actions">
          <button mat-raised-button color="warn" (click)="deleteOrder(order.id)">
            <mat-icon>delete</mat-icon>
            Excluir Pedido
          </button>
        </div>
      </mat-expansion-panel>
    }
  </mat-accordion>
}
